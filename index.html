<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêï vs üêà - Demo Multiplayer Tic Tac Toe</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .game-cell {
            transition: all 0.3s ease;
            font-size: 3rem;
            cursor: pointer;
        }
        .game-cell:hover {
            background-color: #f3f4f6;
            transform: scale(1.05);
        }
        .game-cell.disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }
        .winner-animation {
            animation: bounce 1s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-100 to-purple-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-6xl font-bold text-gray-800 mb-4">üêï vs üêà</h1>
            <h2 class="text-2xl text-gray-600 mb-2">Real-time Multiplayer Tic Tac Toe</h2>
            <div id="connectionStatus" class="inline-flex items-center px-4 py-2 rounded-full bg-red-100 text-red-800">
                <i class="fas fa-circle animate-ping mr-2"></i>
                <span id="statusText">Connecting to Firebase...</span>
            </div>
        </div>

        <!-- Game Setup Screen -->
        <div id="setupScreen" class="max-w-md mx-auto bg-white rounded-xl shadow-lg p-8 fade-in">
            <h3 class="text-2xl font-bold text-center mb-6 text-gray-800">Choose Your Game Mode</h3>
            
            <div class="space-y-4">
                <button id="createRoomBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300 transform hover:scale-105">
                    <i class="fas fa-plus mr-2"></i>Create New Room
                </button>
                
                <div class="text-center text-gray-500">OR</div>
                
                <div class="flex space-x-2">
                    <input id="roomCodeInput" type="text" placeholder="Enter Room Code" 
                           class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent uppercase">
                    <button id="joinRoomBtn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300">
                        <i class="fas fa-sign-in-alt"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Room Info Screen -->
        <div id="roomScreen" class="max-w-md mx-auto bg-white rounded-xl shadow-lg p-8 hidden fade-in">
            <div class="text-center">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">Room Created!</h3>
                <div class="bg-gray-100 rounded-lg p-4 mb-4">
                    <p class="text-sm text-gray-600 mb-2">Room Code:</p>
                    <p id="displayRoomCode" class="text-3xl font-bold text-blue-600 tracking-wider"></p>
                </div>
                
                <button id="copyRoomCode" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg mb-4 transition duration-300">
                    <i class="fas fa-copy mr-2"></i>Copy Room Code
                </button>
                
                <div class="text-center">
                    <p class="text-gray-600 mb-2">Waiting for opponent...</p>
                    <div class="flex justify-center space-x-2">
                        <div class="w-3 h-3 bg-blue-500 rounded-full animate-bounce"></div>
                        <div class="w-3 h-3 bg-blue-500 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                        <div class="w-3 h-3 bg-blue-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Board -->
        <div id="gameScreen" class="max-w-2xl mx-auto hidden fade-in">
            <!-- Game Info -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <div class="text-center">
                        <p class="text-sm text-gray-600">Room Code</p>
                        <p id="gameRoomCode" class="text-lg font-bold text-blue-600"></p>
                    </div>
                    <div class="text-center">
                        <p class="text-sm text-gray-600">Current Turn</p>
                        <p id="currentTurn" class="text-2xl font-bold"></p>
                    </div>
                    <div class="text-center">
                        <p class="text-sm text-gray-600">You are</p>
                        <p id="playerSymbol" class="text-2xl font-bold"></p>
                    </div>
                </div>
                
                <div class="flex justify-between text-sm text-gray-600">
                    <span>üêï Player: <span id="dogPlayer" class="font-semibold">Waiting...</span></span>
                    <span>üêà Player: <span id="catPlayer" class="font-semibold">Waiting...</span></span>
                </div>
            </div>

            <!-- Tic Tac Toe Board -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div id="gameBoard" class="grid grid-cols-3 gap-4 max-w-md mx-auto">
                    <div class="game-cell w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center border-2 border-gray-200" data-index="0"></div>
                    <div class="game-cell w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center border-2 border-gray-200" data-index="1"></div>
                    <div class="game-cell w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center border-2 border-gray-200" data-index="2"></div>
                    <div class="game-cell w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center border-2 border-gray-200" data-index="3"></div>
                    <div class="game-cell w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center border-2 border-gray-200" data-index="4"></div>
                    <div class="game-cell w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center border-2 border-gray-200" data-index="5"></div>
                    <div class="game-cell w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center border-2 border-gray-200" data-index="6"></div>
                    <div class="game-cell w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center border-2 border-gray-200" data-index="7"></div>
                    <div class="game-cell w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center border-2 border-gray-200" data-index="8"></div>
                </div>
                
                <!-- Game Status -->
                <div id="gameStatus" class="text-center mt-6">
                    <p class="text-lg text-gray-600">Make your move!</p>
                </div>
                
                <!-- Game Controls -->
                <div class="flex justify-center space-x-4 mt-6">
                    <button id="newGameBtn" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg transition duration-300 hidden">
                        <i class="fas fa-redo mr-2"></i>New Game
                    </button>
                    <button id="leaveGameBtn" class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg transition duration-300">
                        <i class="fas fa-sign-out-alt mr-2"></i>Leave Game
                    </button>
                </div>
            </div>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="max-w-md mx-auto bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mt-4 hidden">
            <div class="flex items-center">
                <i class="fas fa-exclamation-triangle mr-2"></i>
                <span id="errorText"></span>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC6xPEfICQcxTowMZiy4HWLl-oFxwhWrN8",
            authDomain: "tic-tac-toe-3d08c.firebaseapp.com",
            databaseURL: "https://tic-tac-toe-3d08c-default-rtdb.firebaseapp.com",
            projectId: "tic-tac-toe-3d08c",
            storageBucket: "tic-tac-toe-3d08c.firebasestorage.app",
            messagingSenderId: "922471928803",
            appId: "1:922471928803:web:4d05c42e85c129abb406d6",
            measurementId: "G-SVMQSHGR98"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Game State
        let currentRoom = null;
        let playerSymbol = null;
        let gameState = {
            board: Array(9).fill(''),
            currentPlayer: 'üêï',
            gameOver: false,
            winner: null,
            players: {}
        };

        // DOM Elements
        const setupScreen = document.getElementById('setupScreen');
        const roomScreen = document.getElementById('roomScreen');
        const gameScreen = document.getElementById('gameScreen');
        const connectionStatus = document.getElementById('connectionStatus');
        const statusText = document.getElementById('statusText');
        const createRoomBtn = document.getElementById('createRoomBtn');
        const joinRoomBtn = document.getElementById('joinRoomBtn');
        const roomCodeInput = document.getElementById('roomCodeInput');
        const displayRoomCode = document.getElementById('displayRoomCode');
        const gameRoomCode = document.getElementById('gameRoomCode');
        const copyRoomCode = document.getElementById('copyRoomCode');
        const gameBoard = document.getElementById('gameBoard');
        const currentTurn = document.getElementById('currentTurn');
        const playerSymbolEl = document.getElementById('playerSymbol');
        const gameStatus = document.getElementById('gameStatus');
        const newGameBtn = document.getElementById('newGameBtn');
        const leaveGameBtn = document.getElementById('leaveGameBtn');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        const dogPlayer = document.getElementById('dogPlayer');
        const catPlayer = document.getElementById('catPlayer');

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            checkFirebaseConnection();
        });

        function setupEventListeners() {
            createRoomBtn.addEventListener('click', createRoom);
            joinRoomBtn.addEventListener('click', joinRoom);
            roomCodeInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') joinRoom();
            });
            copyRoomCode.addEventListener('click', copyToClipboard);
            newGameBtn.addEventListener('click', resetGame);
            leaveGameBtn.addEventListener('click', leaveGame);

            // Game board clicks
            gameBoard.addEventListener('click', function(e) {
                if (e.target.classList.contains('game-cell')) {
                    makeMove(parseInt(e.target.dataset.index));
                }
            });
        }

        function checkFirebaseConnection() {
            const connectedRef = database.ref('.info/connected');
            connectedRef.on('value', function(snapshot) {
                if (snapshot.val() === true) {
                    updateConnectionStatus(true, 'Connected to Firebase');
                } else {
                    updateConnectionStatus(false, 'Disconnected from Firebase');
                }
            });
        }

        function updateConnectionStatus(connected, message) {
            statusText.textContent = message;
            connectionStatus.className = connected 
                ? 'inline-flex items-center px-4 py-2 rounded-full bg-green-100 text-green-800'
                : 'inline-flex items-center px-4 py-2 rounded-full bg-red-100 text-red-800';
        }

        function generateRoomCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        function createRoom() {
            const roomCode = generateRoomCode();
            const playerId = generatePlayerId();
            
            currentRoom = roomCode;
            playerSymbol = 'üêï';
            
            const roomRef = database.ref('rooms/' + roomCode);
            roomRef.set({
                board: Array(9).fill(''),
                currentPlayer: 'üêï',
                gameOver: false,
                winner: null,
                players: {
                    [playerId]: {
                        symbol: 'üêï',
                        name: 'Player 1',
                        connected: true
                    }
                },
                createdAt: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                displayRoomCode.textContent = roomCode;
                showScreen('room');
                listenToRoom(roomCode);
            }).catch(error => {
                showError('Failed to create room: ' + error.message);
            });
        }

        function joinRoom() {
            const roomCode = roomCodeInput.value.trim().toUpperCase();
            if (!roomCode) {
                showError('Please enter a room code');
                return;
            }

            const roomRef = database.ref('rooms/' + roomCode);
            roomRef.once('value').then(snapshot => {
                if (!snapshot.exists()) {
                    showError('Room not found');
                    return;
                }

                const roomData = snapshot.val();
                const playerCount = Object.keys(roomData.players || {}).length;
                
                if (playerCount >= 2) {
                    showError('Room is full');
                    return;
                }

                const playerId = generatePlayerId();
                currentRoom = roomCode;
                playerSymbol = 'üêà';

                // Add player to room
                roomRef.child('players/' + playerId).set({
                    symbol: 'üêà',
                    name: 'Player 2',
                    connected: true
                }).then(() => {
                    gameRoomCode.textContent = roomCode;
                    showScreen('game');
                    listenToRoom(roomCode);
                });
            }).catch(error => {
                showError('Failed to join room: ' + error.message);
            });
        }

        function listenToRoom(roomCode) {
            const roomRef = database.ref('rooms/' + roomCode);
            
            roomRef.on('value', snapshot => {
                if (!snapshot.exists()) {
                    showError('Room no longer exists');
                    return;
                }

                const data = snapshot.val();
                updateGameState(data);
                
                // Check if both players have joined
                const playerCount = Object.keys(data.players || {}).length;
                if (playerCount === 2 && roomScreen.style.display !== 'none') {
                    gameRoomCode.textContent = roomCode;
                    showScreen('game');
                }
            });
        }

        function updateGameState(data) {
            gameState = data;
            
            // Update board
            const cells = gameBoard.querySelectorAll('.game-cell');
            cells.forEach((cell, index) => {
                cell.textContent = data.board[index];
                cell.classList.toggle('disabled', data.gameOver || data.board[index] !== '');
            });

            // Update current turn
            currentTurn.textContent = data.currentPlayer;
            currentTurn.className = data.currentPlayer === playerSymbol ? 'text-2xl font-bold text-green-600' : 'text-2xl font-bold text-gray-600';

            // Update player symbol
            playerSymbolEl.textContent = playerSymbol;
            playerSymbolEl.className = 'text-2xl font-bold text-blue-600';

            // Update player list
            const players = Object.values(data.players || {});
            const dogPlayerData = players.find(p => p.symbol === 'üêï');
            const catPlayerData = players.find(p => p.symbol === 'üêà');
            
            dogPlayer.textContent = dogPlayerData ? dogPlayerData.name : 'Waiting...';
            catPlayer.textContent = catPlayerData ? catPlayerData.name : 'Waiting...';

            // Update game status
            updateGameStatus();
        }

        function updateGameStatus() {
            if (gameState.gameOver) {
                if (gameState.winner) {
                    const isWinner = gameState.winner === playerSymbol;
                    gameStatus.innerHTML = isWinner 
                        ? `<p class="text-2xl font-bold text-green-600 winner-animation">üéâ You Win! üéâ</p>`
                        : `<p class="text-2xl font-bold text-red-600">üòî You Lose üòî</p>`;
                } else {
                    gameStatus.innerHTML = `<p class="text-2xl font-bold text-yellow-600">ü§ù It's a Draw! ü§ù</p>`;
                }
                newGameBtn.classList.remove('hidden');
            } else {
                const isMyTurn = gameState.currentPlayer === playerSymbol;
                gameStatus.innerHTML = isMyTurn 
                    ? `<p class="text-lg text-green-600 font-semibold pulse">Your turn!</p>`
                    : `<p class="text-lg text-gray-600">Waiting for opponent...</p>`;
                newGameBtn.classList.add('hidden');
            }
        }

        function makeMove(index) {
            if (!currentRoom || gameState.gameOver || gameState.board[index] !== '' || gameState.currentPlayer !== playerSymbol) {
                return;
            }

            const newBoard = [...gameState.board];
            newBoard[index] = playerSymbol;

            const winner = checkWinner(newBoard);
            const isDraw = newBoard.every(cell => cell !== '') && !winner;
            const nextPlayer = gameState.currentPlayer === 'üêï' ? 'üêà' : 'üêï';

            database.ref('rooms/' + currentRoom).update({
                board: newBoard,
                currentPlayer: nextPlayer,
                gameOver: winner || isDraw,
                winner: winner
            });
        }

        function checkWinner(board) {
            const winPatterns = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8], // rows
                [0, 3, 6], [1, 4, 7], [2, 5, 8], // columns
                [0, 4, 8], [2, 4, 6] // diagonals
            ];

            for (let pattern of winPatterns) {
                const [a, b, c] = pattern;
                if (board[a] && board[a] === board[b] && board[a] === board[c]) {
                    return board[a];
                }
            }
            return null;
        }

        function resetGame() {
            if (!currentRoom) return;

            database.ref('rooms/' + currentRoom).update({
                board: Array(9).fill(''),
                currentPlayer: 'üêï',
                gameOver: false,
                winner: null
            });
        }

        function leaveGame() {
            if (currentRoom) {
                database.ref('rooms/' + currentRoom).off();
                currentRoom = null;
                playerSymbol = null;
            }
            roomCodeInput.value = '';
            showScreen('setup');
        }

        function copyToClipboard() {
            const roomCode = displayRoomCode.textContent;
            navigator.clipboard.writeText(roomCode).then(() => {
                const originalText = copyRoomCode.innerHTML;
                copyRoomCode.innerHTML = '<i class="fas fa-check mr-2"></i>Copied!';
                setTimeout(() => {
                    copyRoomCode.innerHTML = originalText;
                }, 2000);
            });
        }

        function generatePlayerId() {
            return 'player_' + Math.random().toString(36).substring(2, 15);
        }

        function showScreen(screen) {
            setupScreen.classList.add('hidden');
            roomScreen.classList.add('hidden');
            gameScreen.classList.add('hidden');
            errorMessage.classList.add('hidden');

            switch(screen) {
                case 'setup':
                    setupScreen.classList.remove('hidden');
                    break;
                case 'room':
                    roomScreen.classList.remove('hidden');
                    break;
                case 'game':
                    gameScreen.classList.remove('hidden');
                    break;
            }
        }

        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.remove('hidden');
            setTimeout(() => {
                errorMessage.classList.add('hidden');
            }, 5000);
        }
    </script>
</body>
</html>
